@model IEnumerable<DAL.Models.User>
@{
  ViewData["Title"] = "UserListData Page";
  Layout = "_Layout";
}


<!-- user list -->
<div class="user-list-main-div  d-flex justify-content-between mt-2">
  <!-- user txt -->
  <div class="user-div d-flex col-md-3">
    <div class="user-text fs-2 fw-bold ">Users</div>
  </div>

  <!-- search add user -->
  <div class="search-adduser-div d-flex align-items-center justify-content-between mt-2">
    <div class="search-button ">
      <input type="text" id="searchbtn" placeholder="Search" class="p-1 border ">
      <i class="fa-solid fa-magnifying-glass search-icon-style "></i>
    </div>
    <div class="add-user-button">
      <a asp-action="AddUser" asp-controller="User" class="btn solid-btn text-light p-2 ms-3 border text">+ Add
        User</a>
    </div>

  </div>
</div>

<!-- table -->
<div class="container">
  <div class="table-main-div table-responsive p-3 m-3 mb-0 bg-white mt-3 shadow-lg">
    <table id="table" class="table">
      <thead>
        <tr class="border border-top-0 border-end-0 border-start-0 border-dark">
          <th scope="col" class="fw-bold text-start text-nowrap">Name <i class="bi bi-arrow-down-up"></i></th>
          <th scope="col" class="fw-bold text-start">Email</th>
          <th scope="col" class="fw-bold text-start">Phone</th>
          <th scope="col" class="fw-bold text-start text-nowrap">Role<i class="bi bi-arrow-down-up"></i></th>
          <th scope="col" class="fw-bold text-start">Status</th>
          <th scope="col" class="fw-bold text-start">Action </th>
        </tr>
      </thead>
      <tbody>
       @* @foreach (var item in Model)
        {
          if (!item.Isdelete)
          {
<<<<<<< HEAD
            <tr class="border border-top-0 border-end-0 border-start-0 border-teritory">
              <td class="text-start text-nowrap"><img src="images/Default_pfp.svg.png" class="img-fluid me-1" width="25px"
                  alt="">
=======
            <tr>
              x<td>
>>>>>>> 7ab8b43029a957c249444e9977747c5be2dba754
                @Html.DisplayFor(modelItem => item.FirstName) @Html.DisplayFor(modelItem => item.LastName)
              </td>
              <td class="text-start">
                @Html.DisplayFor(modelItem => item.Userlogin.Email)
              </td>
              <td class="text-start">
                @Html.DisplayFor(modelItem => item.Phone)
              </td>
              <td class="text-start">
                @Html.DisplayFor(modelItem => item.Userlogin.Role.RoleName)
              </td>
              <td class="text-start">
                @if (item.Status == true)
                {
                  <div class="text-center text-white bg-success rounded-pill w-75 fs-6 p-md-1 p-2">
                    Active</div>
                }
                else
                {
                  <div class="text-center text-white bg-danger rounded-pill w-75 fs-6 p-md-1 p-2">
                    Inactive</div>
                }

              </td>
              <td class="text-start">
                <a asp-action="EditUser" asp-controller="User" asp-route-Email="@item.Userlogin.Email" class="text-dark"><i
                    class="fa-solid fa-pen w-25 me-sm-2 me-xs-2 me-lg-0 "></i></a>
                <i class="fa-solid fa-trash-can" data-bs-toggle="modal" data-bs-target="#delete-user"
                  data-email="@item.Userlogin.Email"></i>
              </td>
            </tr>
          }

        } *@


      </tbody>
    </table>

  </div>

<<<<<<< HEAD
  <div class="pagination-main-div d-flex justify-content-end gap-2 p-3 pt-0 bg-white ms-3 me-2">

    <span class="mt-2">Items Per page:</span>
    <select name="" id="" class="itemselect">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>
    <span class="mt-2"></span>
    <i class="fa-solid fa-angle-left btn border border-dark bg-light ms-2 d-flex align-content-center"></i>
    <i class="fa-solid fa-angle-right btn border border-dark bg-light ms-2 "></i>
  </div>

=======
>>>>>>> 7ab8b43029a957c249444e9977747c5be2dba754
</div>

<div class="pagination-main-div d-flex justify-content-end gap-2 p-3 pt-0 bg-white ms-3 me-3">

  <span>Items Per page:</span>
  <select name="" id="">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
  </select>
  <span>Showing 1-5 of 13</span>
  <i class="fa-solid fa-angle-left btn border border-dark bg-light ms-2 d-flex align-content-center"></i>
  <i class="fa-solid fa-angle-right btn border border-dark bg-light ms-2 "></i>
</div>

<!-- delete item modal-->
<div id="delete-user" class="modal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold text-secondary">Delete Conformation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body ">
        <div class="d-flex justify-content-center"><img src="../images/toppng.com-warning-icon-2400x2400.png"
            style="width: 30px;" alt=""></div>
        <p class="fw-bold text-secondary text-center">Are you sure you want to delete this user ?</p>
        <form method="post" asp-action="DeleteUser" asp-controller="User">
          <input type="hidden" id="deleteEmail" name="Email" />

          <div class="modal-footer d-flex justify-content-center">
            <button type="submit" class="btn solid-btn">Yes</button>
            <button type="button" class="btn hollow-btn" data-bs-dismiss="modal">No</button>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>

@section Scripts {
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  @* <script>
$(document).ready(function () {
let currentPage = 1;
let pageSize = 5;
let searchQuery = "";

function fetchUsers() {
$.ajax({
url: `/User/UserListData?page=${currentPage}&pageSize=${pageSize}&search=${searchQuery}`,
type: "GET",
success: function (data) {
let tbody = $('#table tbody');
tbody.empty();

$.each(data.users, function (index, user) {
console.log(user);
let statusClass = user.Status === "Active" ? "bg-success" : "bg-danger";
let row = `
<tr>
<td>${user.Name}</td>
<td>${user.Email}</td>
<td>${user.Phone}</td>
<td>${user.Role}</td>
<td>
<div class="text-center text-white ${statusClass} rounded-pill w-75 p-lg-0 ps-1 pe-4">
${user.Status}
</div>
</td>
<td>
<a href="/User/Edit/${user.UserId}">
<i class="fa-solid fa-pen w-25 me-sm-2 me-xs-2 me-lg-0 text-dark"></i>
</a>
<a data-userid="${user.UserId}" class="delete-user">
<i class="fa-solid fa-trash-can"></i>
</a>
</td>
</tr>
`;
tbody.append(row);
});

$('.pagination-main-div span:nth-child(2)').text(
`Showing ${data.start}-${data.end} of ${data.totalRecords}`
);
}
});
}

// Search functionality
$('#searchbtn').on('keyup', function () {
searchQuery = $(this).val();
currentPage = 1;
fetchUsers();
});

// Items per page dropdown
$('.itemselect select').on('change', function () {
pageSize = $(this).val();
currentPage = 1;
fetchUsers();
});

// Pagination buttons
$('.fa-angle-left').on('click', function () {
if (currentPage > 1) {
currentPage--;
fetchUsers();
}
});

$('.fa-angle-right').on('click', function () {
currentPage++;
fetchUsers();
});

// Initial fetch
fetchUsers();
});
</script> *@

<<<<<<< HEAD
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var deleteModal = document.getElementById('delete-user');
      deleteModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var email = button.getAttribute('data-email');
        var deleteEmailInput = document.getElementById('deleteEmail');
        deleteEmailInput.value = email;
      });
    });
  </script>

   <script>
        $(document).ready(function () {
            var successMessage = '@TempData["SuccessMessage"]';
            var errorMessage = '@TempData["ErrorMessage"]';
            console.log("successMessage",successMessage);
            if (successMessage) 
            {
              toastr.success(successMessage);
            }
            if (errorMessage && errorMessage == "") 
            {
              toastr.error(errorMessage);
            }
            });
    </script>

}
=======
@* <script>
  $(document).ready(function () {
    let currentPage = 1;
    let pageSize = 5;
    let searchQuery = "";

    function fetchUsers() {
        $.ajax({
            url: `/User/GetUsers?page=${currentPage}&pageSize=${pageSize}&search=${searchQuery}`,
            type: "GET",
            success: function (data) {
                $('#example tbody').html(data.html);
                $('.pagination-main-div span:nth-child(3)').text(
                    `Showing ${data.start}-${data.end} of ${data.totalRecords}`
                );
            }
        });
    }

    // Search functionality
    $('.search-button input').on('keyup', function () {
        searchQuery = $(this).val();
        currentPage = 1; // Reset to first page when searching
        fetchUsers();
    });

    // Items per page dropdown
    $('.pagination-main-div select').on('change', function () {
        pageSize = $(this).val();
        currentPage = 1;
        fetchUsers();
    });

    // Pagination buttons
    $('.fa-angle-left').on('click', function () {
        if (currentPage > 1) {
            currentPage--;
            fetchUsers();
        }
    });

    $('.fa-angle-right').on('click', function () {
        currentPage++;
        fetchUsers();
    });

    // Initial fetch
    fetchUsers();
});

</script> *@

<script>
  $(document).ready(function () {
    let currentPage = 1;
    let pageSize = 5;
    let searchQuery = "";

    function fetchUsers() {
        $.ajax({
            url: `/User/GetUsers?page=${currentPage}&pageSize=${pageSize}&search=${searchQuery}`,
            type: "GET",
            success: function (data) {
                let tbody = $('#example tbody');
                tbody.empty();

                $.each(data.users, function (index, user) {
                    let statusClass = user.Status === "Active" ? "bg-success" : "bg-danger";
                    let row = `
                        <tr>
                            <td>${user.Name}</td>
                            <td>${user.Email}</td>
                            <td>${user.Phone}</td>
                            <td>${user.Role}</td>
                            <td>
                                <div class="text-center text-white ${statusClass} rounded-pill w-75 p-lg-0 ps-1 pe-4">
                                    ${user.Status}
                                </div>
                            </td>
                            <td>
                                <a href="/User/Edit/${user.UserId}">
                                    <i class="fa-solid fa-pen w-25 me-sm-2 me-xs-2 me-lg-0 text-dark"></i>
                                </a>
                                <a data-userid="${user.UserId}" class="delete-user">
                                    <i class="fa-solid fa-trash-can"></i>
                                </a>
                            </td>
                        </tr>
                    `;
                    tbody.append(row);
                });

                $('.pagination-main-div span:nth-child(3)').text(
                    `Showing ${data.start}-${data.end} of ${data.totalRecords}`
                );
            }
        });
    }

    // Search functionality
    $('.search-button input').on('keyup', function () {
        searchQuery = $(this).val();
        currentPage = 1;
        fetchUsers();
    });

    // Items per page dropdown
    $('.pagination-main-div select').on('change', function () {
        pageSize = $(this).val();
        currentPage = 1;
        fetchUsers();
    });

    // Pagination buttons
    $('.fa-angle-left').on('click', function () {
        if (currentPage > 1) {
            currentPage--;
            fetchUsers();
        }
    });

    $('.fa-angle-right').on('click', function () {
        currentPage++;
        fetchUsers();
    });

    // Initial fetch
    fetchUsers();
});
</script>

}
>>>>>>> 7ab8b43029a957c249444e9977747c5be2dba754
