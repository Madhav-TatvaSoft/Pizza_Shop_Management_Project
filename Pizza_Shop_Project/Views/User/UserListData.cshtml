@model IEnumerable<DAL.Models.User>
@{
  ViewData["Title"] = "UserListData Page";
  Layout = "_Layout";
}


<!-- user list -->
<div class="user-list-main-div  d-flex justify-content-between mt-2">
  <!-- user txt -->
  <div class="user-div d-flex col-md-3">
    <div class="user-text fs-2 fw-bold text-primary">Users</div>
  </div>

  <!-- search add user -->
  <div class="search-adduser-div d-flex align-items-center justify-content-between mt-2">
    <div class="search-button ">
      <input type="text" name="" id="" placeholder="Search" class="p-1 border ">
      <i class="fa-solid fa-magnifying-glass search-icon-style "></i>
    </div>
    <div class="adduser-button">
      <a asp-action="AddUser" asp-controller="User" class="btn btn-primary text-light p-2 ms-3 border text">+ Add
        User</a>
    </div>

  </div>
</div>

<!-- table -->
<div class="container">
  <div class="table-main-div table-responsive mt-3 bg-white mx-auto ">
    <table id="example" class="table display">
      <thead>
        <tr>
          <th scope="col">Name <i class="bi bi-arrow-down-up"></i></th>
          <th scope="col">Email</th>
          <th scope="col">Phone</th>
          <th scope="col">Role<i class="bi bi-arrow-down-up ms-1"></i></th>
          <th scope="col">Status</th>
          <th scope="col">Action </th>
        </tr>
      </thead>
      <tbody>
       @* @foreach (var item in Model)
        {
          if (!item.Isdelete)
          {
            <tr>
              x<td>
                @Html.DisplayFor(modelItem => item.FirstName) @Html.DisplayFor(modelItem => item.LastName)
              </td>
              <td>
                @Html.DisplayFor(modelItem => item.Userlogin.Email)
              </td>
              <td>
                @Html.DisplayFor(modelItem => item.Phone)
              </td>
              <td>
                @Html.DisplayFor(modelItem => item.Userlogin.Role.RoleName)
              </td>
              <td>
                @if (item.Status == true)
                {
                  <div class="text-center text-white bg-success rounded-pill w-75 p-lg-0 ps-1 pe-4">
                    Active</div>
                }
                else
                {
                  <div class="text-center text-white bg-danger rounded-pill w-75 p-lg-0 ps-1 pe-4">
                    Inactive</div>
                }

              </td>
              <td>
                <a asp-action="Edit" asp-route-id="@item.UserloginId"><i
                    class="fa-solid fa-pen w-25 me-sm-2 me-xs-2 me-lg-0 text-dark"></i></a>
                <a><i class="fa-solid fa-trash-can" data-bs-toggle="modal" data-bs-target="#delete-user"></i></a>
                <!-- delete item modal-->
                <div id="delete-user" class="modal" tabindex="-1">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title">Delete Conformation</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body ">
                        <div class="delete-cat-image d-flex flex-column  align-items-center">
                          <img src="images/toppng.com-warning-icon-2400x2400.png" width="50px" alt="">
                          <p>Are you sure you want to delete this User?</p>
                        </div>

                      </div>
                      <div class="modal-footer d-flex justify-content-center">
                        <a class="btn btn-primary" asp-action="DeleteUser" asp-controller="User"
                          asp-route-id="@item.UserId">Yes</a>
                        <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">No</button>
                      </div>
                    </div>
                  </div>
                </div>

              </td>
            </tr>
          }

        } *@


      </tbody>
    </table>

  </div>

</div>

<div class="pagination-main-div d-flex justify-content-end gap-2 p-3 pt-0 bg-white ms-3 me-3">

  <span>Items Per page:</span>
  <select name="" id="">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
  </select>
  <span>Showing 1-5 of 13</span>
  <i class="fa-solid fa-angle-left btn border border-dark bg-light ms-2 d-flex align-content-center"></i>
  <i class="fa-solid fa-angle-right btn border border-dark bg-light ms-2 "></i>
</div>






@section Scripts {
  <script src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>
  @* <script>
let table = new DataTable('#example');

table.on('click', 'tbody tr', function () {
let data = table.row(this).data();

alert('You clicked on ' + data[0] + "'s row");
});
</script> *@

@* <script>
  $(document).ready(function () {
    let currentPage = 1;
    let pageSize = 5;
    let searchQuery = "";

    function fetchUsers() {
        $.ajax({
            url: `/User/GetUsers?page=${currentPage}&pageSize=${pageSize}&search=${searchQuery}`,
            type: "GET",
            success: function (data) {
                $('#example tbody').html(data.html);
                $('.pagination-main-div span:nth-child(3)').text(
                    `Showing ${data.start}-${data.end} of ${data.totalRecords}`
                );
            }
        });
    }

    // Search functionality
    $('.search-button input').on('keyup', function () {
        searchQuery = $(this).val();
        currentPage = 1; // Reset to first page when searching
        fetchUsers();
    });

    // Items per page dropdown
    $('.pagination-main-div select').on('change', function () {
        pageSize = $(this).val();
        currentPage = 1;
        fetchUsers();
    });

    // Pagination buttons
    $('.fa-angle-left').on('click', function () {
        if (currentPage > 1) {
            currentPage--;
            fetchUsers();
        }
    });

    $('.fa-angle-right').on('click', function () {
        currentPage++;
        fetchUsers();
    });

    // Initial fetch
    fetchUsers();
});

</script> *@

<script>
  $(document).ready(function () {
    let currentPage = 1;
    let pageSize = 5;
    let searchQuery = "";

    function fetchUsers() {
        $.ajax({
            url: `/User/GetUsers?page=${currentPage}&pageSize=${pageSize}&search=${searchQuery}`,
            type: "GET",
            success: function (data) {
                let tbody = $('#example tbody');
                tbody.empty();

                $.each(data.users, function (index, user) {
                    let statusClass = user.Status === "Active" ? "bg-success" : "bg-danger";
                    let row = `
                        <tr>
                            <td>${user.Name}</td>
                            <td>${user.Email}</td>
                            <td>${user.Phone}</td>
                            <td>${user.Role}</td>
                            <td>
                                <div class="text-center text-white ${statusClass} rounded-pill w-75 p-lg-0 ps-1 pe-4">
                                    ${user.Status}
                                </div>
                            </td>
                            <td>
                                <a href="/User/Edit/${user.UserId}">
                                    <i class="fa-solid fa-pen w-25 me-sm-2 me-xs-2 me-lg-0 text-dark"></i>
                                </a>
                                <a data-userid="${user.UserId}" class="delete-user">
                                    <i class="fa-solid fa-trash-can"></i>
                                </a>
                            </td>
                        </tr>
                    `;
                    tbody.append(row);
                });

                $('.pagination-main-div span:nth-child(3)').text(
                    `Showing ${data.start}-${data.end} of ${data.totalRecords}`
                );
            }
        });
    }

    // Search functionality
    $('.search-button input').on('keyup', function () {
        searchQuery = $(this).val();
        currentPage = 1;
        fetchUsers();
    });

    // Items per page dropdown
    $('.pagination-main-div select').on('change', function () {
        pageSize = $(this).val();
        currentPage = 1;
        fetchUsers();
    });

    // Pagination buttons
    $('.fa-angle-left').on('click', function () {
        if (currentPage > 1) {
            currentPage--;
            fetchUsers();
        }
    });

    $('.fa-angle-right').on('click', function () {
        currentPage++;
        fetchUsers();
    });

    // Initial fetch
    fetchUsers();
});
</script>

}
